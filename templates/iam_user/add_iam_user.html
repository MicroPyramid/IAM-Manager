{% extends "base.html" %}
{% load iam_custom_tags %}
{% block base %}

<div class="container_block settings">
    <div class="row form_row">
     <div class="col-md-offset-3 col-md-6 col-ms-offset-3 col-sm-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 gradient_panel">
		<form role="form" class="col-md-12 go-right" id="add_iam_user_form" method="post">{% csrf_token %}
			<h2 class="title">IAM User</h2>
			<div class="form-group" id="username">
			<input name="username" type="text" class="form-control">
			<label for="name">UserName</label>
		</div>

		<div class="form-group" id="email">
			<input name="email" type="email" class="form-control">
			<label for="phone">Email</label>
		</div>
		<div class="form-group" id="password">
			<input  name="password" type="password" class="form-control">
			<label for="name">Password</label>
		</div>
		<div class="form-group checkbox checkbox_block text-left">
			<div class="col-md-1 col-xs-1 text-left"><input type="checkbox" name="generate_keys"></div>
      <div class="col-md-11 col-xs-11">
      <span>Generate an access key for user</span>
      <p>Users need access keys to make secure REST or Query protocol requests to AWS service APIs.</p>
      </div>
		</div>
    <div class="form-group checkbox checkbox_block text-left">
      <div class="col-md-1 col-xs-1 text-left"><input type="checkbox" class="ec2_checkbox" name="ec2" value="ec2"></div>
      <div class="col-md-11 col-xs-11">
      <span>EC2</span>
      </div>
    </div>

    <div class="form-group checkbox checkbox_block text-left">
      <div class="col-md-1 col-xs-1 text-left"><input type="checkbox" name="rds" class="rds_checkbox" value="rds"></div>
      <div class="col-md-11 col-xs-11">
      <span>RDS</span>
      </div>
    </div>

    <div class="form-group checkbox checkbox_block text-left">
      <div class="col-md-1 col-xs-1 text-left"><input type="checkbox" name="s3" class="s3_checkbox" value="s3"></div>
      <div class="col-md-11 col-xs-11">
      <span>S3</span>
      </div>
    </div>
    <div class="form-group policy" id="policy_name" style="display:none;">
    <input type="text" name="policy_name" class="form-control">
    <label for="name">Policy Name</label>
    </div>

    <div class="form-group" id="ec2_div" style="display:none;">
    <select name="ec2_instances" class="form-control">
      <option>Please select option</option>
    {% for instance in response_inst %}
    {% for i in instance.Instances %}
      <option value="{{ i.KeyName }}">{{ i.KeyName }}</option>
    {% endfor %}
    {% endfor %}
    </select>
    </div>
    <div class="form-group" id="s3_div" style="display:none;">
    <select name="s3_buckets" class="form-control">
      <option>Please select option</option>
      {% for bucket in response_buckets %}
      <option>{{ bucket.Name }}</option>
    {% endfor %}
      <label for="name">S3 buckets</label>
    </select>
    </div>
    <div class="form-group" id="rds_div" style="display:none;">
    <select name="rds" class="form-control">
      {% for instance in response_inst %}
      <option>Please select option</option>
    {% endfor %}
      <label for="name">RDS</label>
    </select>
    </div>

    <p id="error"></p>
		<div class="row btn_row">
                <div class="col-xs-12 col-md-12 btn_col"><button class="btn btn-success btn-block btn-lg" type="submit">Create</button></div>
            </div>
		</form>
    </div>
	</div>
</div>
</body>
<script type="text/javascript">
      $(document).ready(function(){
      $('#add_iam_user_form').submit(function(e) {
        e.preventDefault();
        $.post('{% url "add_iam_user" %}', $('#add_iam_user_form').serialize(), function(data) {
          if (data.error){
          	$("p.error").remove();
            if (data.response) {
            $('#error').after('<p class="error">' + data.response + '</p>');
          }
          if (data.message){
          	alert(data.message)
          }
          }
          else{
            window.location = "{% url 'iam_users_list' %}"
          }
        },"json");
      });
      });
      $(".ec2_checkbox").change(function(e){
        e.preventDefault();
        if ($(".ec2_checkbox").val() == "ec2"){
        $("#ec2_div").show()
      }
    });
      $(".s3_checkbox").change(function(e){
        e.preventDefault();

      if ($(".s3_checkbox").val() == "s3"){
        $("#s3_div").show()
      }
    });
      $(".rds_checkbox").change(function(e){
        e.preventDefault();
      if ($(".rds_checkbox").val() == "rds"){
        $("#rds_div").show()
      }
      });

 $(".ec2_checkbox").change(function(e){
        e.preventDefault();
        if ($(".ec2_checkbox").val() == "ec2"){
        $(".policy").show()
      }
    });
      </script>
      {% endblock %}
</html>